<!DOCTYPE html>
<html>
	<head>
	<title>Arrange numbers</title>
	<meta charset="UTF-8">
	<link href="game.css" rel="stylesheet" type="text/css">
	<script type = "text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js">
	</script>
	<script type="text/javascript" src="game.js"></script>
	
	</head>
	<body onload="it()">
		<div id="game">
			<div id="gameUI">
			
				<div id="gameIntro">
					<h1>Arrange numbers</h1>
						<p>数字を左上から右へ、1から15まで順番に並べるゲームです<br>
						空きパネルの隣にある数字をクリックすると、位置が入れ替わります<br>
						<p id="gamePlay" class="button" href="">Play</p>
				</div>

				<div id="gameStats">
					<img id="example" src="false.png" width="400" height="350">
					<table id="table"></table>
					<p id="showtime"></p>
					<ul class="setbutton">
						<list id="start" class="button" onclick="count++;" href="">Start</list>　 <!--onclickでタイムカウントをスタートさせる-->
						<list id="gameBack" class="button" href="">Back</list>
						<list id="gameComplete" class="button" href="" >Complete</list>
				</div>

				<div id="clearmain">
					<img src="wagyan.png" width="400" height="350">
				</div>
			</div>
			<canvas id="gameCanvas" width="800" height="600">
			<!-- ここにはフォールバックコンテンツを挿入 -->
			</canvas>
		</div>

		<script>　// 数字並べのコード
		"use strict";  

		// 広域変数
		var tiles = [];

		//　カウンターの設定
		var count = -2; //カウントの初期値
		var timerID = setInterval('countup()',1000); //1秒毎にcountup()を呼び出し

		// カウンターの表示
		function countup() {
			if (count > -2){ // スタートボタンを押すとカウントが開始される
			count++;
			var time = "TIME : " + count;
			document.getElementById("showtime").innerHTML = time;
			}
		}

		// 初期化関数
		function it() {  
			var table = document.getElementById("table");  //  table要素への参照を取得

			for (var i = 0; i < 4; i++) {  //　for文を5回繰り返す事で5行作成
				var tr = document.createElement("tr");  // 各行の作成
			for (var j = 0; j < 4; j++) {  //  for文によるタイルの作成
				var td = document.createElement("td");  //  5×5作成
				var index = i*4 + j;
				td.className = "tile"; // タイルのクラス名
				td.index = index;
				td.value = index;
				td.textContext = index == 0? "":index;
				td.onclick = click;
				tr.appendChild(td);  //  子要素(td要素)を追加
				tiles.push(td);
			}
			table.appendChild(tr);　// tableにtr要素を追加
		
		}

		for (var i = 0; i<1000; i++) {
			click({ srcElement: {index: Math.floor(Math.random()*16)}})
			}

		}

		function click(e) {  //  タイルをクリックした時に空であれば入れ替える
			var i = e.srcElement.index;
			var counter = 0;

		//  タイルの数字を入れ替える時のロジック
			if(i - 4>=0 && tiles[i - 4].value == 0) {　// タイル上と入れ替え
				swap(i,i-4);
			} else if(i + 4< 16 && tiles[i + 4].value == 0) {　// タイル下と入れ替え
				swap(i,i + 4);
			} else if (i % 4!= 0 && tiles[i - 1].value == 0) {　// タイル左隣と入れ替え 
				swap(i,i - 1);
			} else if (i % 4!= 3 && tiles[i + 1].value == 0) {　// タイル右隣と入れ替え
				swap(i,i + 1);
			}

		// パズルのクリア判定　正しい位置の時　indexに1を足すと必ずタイルの番号と一致する
		// indexがタイルの並び順　valueがタイルの番号

			if(tiles[0].index+1 == tiles[0].value) { 
				counter++;
				console.log(tiles[0].value + 'は OK!');
				}else{ console.log(tiles[0].value + 'は NG!');
				}

			if(tiles[1].index+1 == tiles[1].value) { 
				counter++;
				console.log(tiles[1].value + 'は OK!');
				}else{ console.log(tiles[1].value + 'は NG!');
				}

			if(tiles[2].index+1 == tiles[2].value) {　
				counter++;
				console.log(tiles[2].value + 'は OK!');
				}else{ console.log(tiles[2].value + 'は NG!');
				}

			if(tiles[3].index+1 == tiles[3].value) {
				counter++;
				console.log(tiles[3].value + 'は OK!');
				}else{ console.log(tiles[3].value + 'は NG!');
				}

			if(tiles[4].index+1 == tiles[4].value) {
				counter++;
				console.log(tiles[4].value + 'は OK!');
				}else{ console.log(tiles[4].value + 'は NG!');
				}

			if(tiles[5].index+1 == tiles[5].value) {
				counter++;
				console.log(tiles[5].value + 'は OK!');
				}else{ console.log(tiles[5].value + 'は NG!');
				}

			if(tiles[6].index+1 == tiles[6].value) {
				counter++;
				console.log(tiles[6].value + 'は OK!');
				}else{ console.log(tiles[6].value + 'は NG!');
				}

			if(tiles[7].index+1 == tiles[7].value) {
				counter++;
				console.log(tiles[7].value + 'は OK!');
				}else{ console.log(tiles[7].value + 'は NG!');
				}

			if(tiles[8].index+1 == tiles[8].value) {
				counter++;
				console.log(tiles[8].value + 'は OK!');
				}else{ console.log(tiles[8].value + 'は NG!');
				}

			if(tiles[9].index+1 == tiles[9].value) {
				counter++;
				console.log(tiles[9].value + 'は OK!');
				}else{ console.log(tiles[9].value + 'は NG!');
				}

			if(tiles[10].index+1 == tiles[10].value) {
				counter++;
				console.log(tiles[10].value + 'は OK!');
				}else{ console.log(tiles[10].value + 'は NG!');
				}

			if(tiles[11].index+1 == tiles[11].value) {
				counter++;
				console.log(tiles[11].value + 'は OK!');
				}else{ console.log(tiles[11].value + 'は NG!');
				}

			if(tiles[12].index+1 == tiles[12].value) {
				counter++;
				console.log(tiles[12].value + 'は OK!');
				}else{ console.log(tiles[12].value + 'は NG!');
				}

			if(tiles[13].index+1 == tiles[13].value) {
				counter++;
				console.log(tiles[13].value + 'は OK!');
				}else{ console.log(tiles[13].value + 'は NG!');
				}

			if(tiles[14].index+1 == tiles[14].value) {
				counter++;
				console.log(tiles[14].value + 'は OK!');
				}else{ console.log(tiles[14].value + 'は NG!');
				}

			if(tiles[15].index+1 == tiles[15].value) {
				counter++;
				console.log(tiles[15].value + 'は OK!');
				}else{ console.log(tiles[15].value + 'は NG!');
				}

			if (counter < 12) { // クリアした時のタイムカウント停止、ボタンを出現させる処理
				document.getElementById("gameComplete").style.display="none"; // 普段は非表示
				} else if (counter > 12) {
				clearInterval(timerID);
				//document.getElementById("start").textContent="Complete!";
				document.getElementById("gameComplete").style.display="block"; // クリアしたら表示
				console.log("クリア処理OK");
				}
		}

		function swap(i,j) {
			var tmp = tiles[i].value;
			tiles[i].textContent = tiles[j].textContent;
			tiles[i].value = tiles[j].value;
			tiles[j].textContent = tmp;
			tiles[j].value = tmp;
		}

		</script>

	<audio src="sport_03_loop.wav" autoplay loop></audio>
	</body>
</html>